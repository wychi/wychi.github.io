<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
<script type="text/javascript" src="js/adapter.js"></script>

<script type="text/javascript" src="js/shaders/ConvolutionShader.js"></script>
<script type="text/javascript" src="js/shaders/CopyShader.js"></script>
<script type="text/javascript" src="js/shaders/EdgeShader.js"></script>
<script type="text/javascript" src="js/shaders/CustomShader.js"></script>

<script type="text/javascript" src="js/postprocessing/EffectComposer.js"></script>
<script type="text/javascript" src="js/postprocessing/RenderPass.js"></script>
<script type="text/javascript" src="js/postprocessing/MaskPass.js"></script>
<script type="text/javascript" src="js/postprocessing/BloomPass.js"></script>
<script type="text/javascript" src="js/postprocessing/ShaderPass.js"></script>

<style>
#container {
  width: 100vw;
  height: 100vh;
}

</style>
</head>

<body>

<div id="container">
</div>

<script>
var WIDTH = 0;
var HEIGHT = 0;

var container;
var camera, scene, renderer;
var texture, material, mesh;
var composer;

init();
render();

function init() {

	container = document.getElementById( 'container' );
  var w = container.clientWidth - 20;
  var h = container.clientHeight - 20;
  console.log(w, h);

  camera = new THREE.OrthographicCamera( w / - 2, w / 2, h / 2, h / - 2, 1, 1000 );
	camera.position.x = 0;
  camera.position.y = 0;
  camera.position.z = 1000;
  scene = new THREE.Scene();
	
  renderer = new THREE.WebGLRenderer();
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize(w, h);
  renderer.autoClear = false;
  container.appendChild( renderer.domElement );
  
  var a_texCoord = [
      0.0,  0.0,
      1.0,  0.0,
      0.0,  1.0,
      0.0,  1.0,
      1.0,  0.0,
      1.0,  1.0];
  var x1 = 0, y1=0, x2 = w, y2 = h;
  var a_position = [
       x1, y1,
       x2, y1,
       x1, y2,
       x1, y2,
       x2, y1,
       x2, y2];

  var texture = THREE.ImageUtils.loadTexture( "1.png" );
  texture.minFilter = THREE.LinearFilter;
  texture.magFilter = THREE.LinearFilter;

  //https://github.com/mrdoob/three.js/wiki/Uniforms-types

  // material = new THREE.ShaderMaterial( {
  //   uniforms: {
  //     u_image: { type: "t", value: texture },
  //     u_resolution: { type: "v2", value: new THREE.Vector2( w, h ) }
  //   },
  //   attributes: {
  //     a_position: { type: 'fv', value: a_position },
  //     a_texCoord: { type: 'fv', value: a_texCoord },
  //   },
  //   vertexShader: THREE.CustomShader.vertexShader,
  //   fragmentShader: THREE.CustomShader.fragmentShader    
  // });

  material = new THREE.ShaderMaterial( {
    uniforms: {
      gxl3d_ModelViewProjectionMatrix: {
        type: "m4", value: new THREE.Matrix4()
      },
      tex0: { type: "t", value: texture },
      resolution: { type: "v2", value: new THREE.Vector2( w, h ) },
      mouse: { type: "v2", value: new THREE.Vector2( w/2, h/2 ) },
      lensSize: { type: 'f', value: 0.4}
    },
    vertexShader: THREE.FishEyeShader.vertexShader,
    fragmentShader: THREE.FishEyeShader.fragmentShader    
  });

  var geometry = new THREE.PlaneBufferGeometry(w, h);
  console.log(geometry.vertices);
  mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);
}

function render() {
  requestAnimationFrame( render );
  renderer.render(scene, camera);
}

</script>
</body>
</html>
